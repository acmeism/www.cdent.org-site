#!/usr/bin/env perl

use strict;
use warnings;
use WikiText::Socialtext::Parser;
use WikiText::HTML::Emitter;

my $html_already = 0;

my $input = do { local $/; <> };
$input =~ s/\r//g;
my $html = '';

$html = WikiText::Socialtext::Parser->new(
   receiver => WikiText::HTML::Emitter->new(
       callbacks => {
           wikilink => sub {
               my $node = shift;
               my $target = $node->{attributes}{target};
               return "$target/index.html";
           },
       },
   ),
)->parse($input);

print <<"...";
[% WRAPPER wrapper.html %]
$html
[% END %]
...
